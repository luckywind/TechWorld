[参考](https://www.computerworld.com/article/2833435/how-to-interpret-cpu-load-on-linux.html)

在 Linux 系统下，可以使用许多工具来监控 CPU、内存和磁盘资源的使用情况。下面是三个常用的监控工具：

1. top：用于实时查看系统的进程状态、CPU 使用率和内存使用情况等。在终端输入 top 命令即可启动该工具。top 命令的选项和功能非常丰富，可以通过 man top 命令查看详细文档。
2. vmstat：用于显示系统虚拟内存的使用情况和统计进程、IO 等系统状态。在终端输入 vmstat 命令即可启动该工具。vmstat 命令的选项和用法在上一个问题中已经介绍过。
3. iostat：用于监控磁盘 I/O 操作的情况。在终端输入 iostat 命令即可启动该工具。iostat 命令可以显示磁盘读写速率、I/O 请求等信息。iostat 命令的选项和用法可以通过 man iostat 命令查看详细文档。

除了上述工具，还有一些其他的资源监控工具，例如 sar、nmon、htop 等。

# top

1. `top`：是 top 命令的进程 ID。
2. `Tasks`：表示当前系统运行的进程数，包括正在运行、等待、停止和僵尸进程。
3. `%Cpu(s)`：包含 CPU 使用率的相关信息：
   - `us`：用户占用 CPU 百分比。
   - `sy`：内核占用 CPU 百分比。
   - `ni`：用户进程空间内改变过优先级的进程占用 CPU 的百分比。
   - `id`：系统空闲 CPU 百分比。
   - `wa`：等待 I/O 的 CPU 占用百分比。
   - `hi`：硬件中断（Hardware IRQ）占用的CPU百分比。
   - `si`：软件中断（Software IRQ）占用的CPU百分比。
4. `Mem`：包含内存使用情况的相关信息：
   - `total`：总内存大小。
   - `used`：已使用的内存大小。
   - `free`：可用的内存大小。
   - `buf/cache`：用于缓存（Buffer 和 Cache）的内存大小。
5. `Swap`：包含交换空间（Swap）使用情况的相关信息：
   - `total`：总交换空间大小。
   - `used`：已使用的交换空间大小。
   - `free`：可用的交换空间大小。
6. `PID`：表示进程的 ID。
7. `USER`：表示进程的所属用户。
8. `%CPU`：表示进程使用的 CPU 百分比。
9. `%MEM`：表示进程使用的内存百分比。
10. `TIME+`：表示进程运行的时间，包括了用户态和内核态的时间。
11. `COMMAND`：表示进程的命令行。

top - 17:42:30 up  6:16,  4 users,  load average: 0.10, 0.05, 0.18
Tasks: 979 total,   2 running, 977 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni, 99.9 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem : 26341355+total, 23542512+free, 13165988 used, 14822444 buff/cache
KiB Swap: 32767996 total, 32767996 free,        0 used. 24934009+avail Mem 

   PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                        
 18343 hadoop    20   0   33.3g   1.4g  24468 S   1.7  0.6   4:08.27 java                                                                                                           
 18136 hadoop    20   0   33.2g   1.0g  24284 S   0.7  0.4   2:33.80 java                                                                                                           
 22114 root      20   0   66.3g 582940  15292 S   0.7  0.2   0:58.09 java                                                                                                           
 38599 root      20   0 6696292 533136   7044 S   0.7  0.2   1:17.10 cpptools                                                                                                       
 39293 root      20   0  114080   2272   1232 S   0.7  0.0   0:18.11 bash                                                                                                           
 72641 root      20   0  163028   3232   1584 R   0.7  0.0   0:01.27 top                                                                                                            
     9 root      20   0       0      0      0 R   0.3  0.0   0:17.67 rcu_sched  

# vmstat

用于展示系统虚拟内存的使用情况和统计进程、IO 等系统状态。以下是 vmstat 的基本用法：

语法

```
vmstat [options] [delay [count]]
```

参数

- `delay`：数据采样的时间间隔。
- `count`：数据采样的次数。

选项

- `-a`：显示所有状态信息。
- `-n`：禁止显示标题。
- `-s`：显示虚拟内存的总量和使用情况。
- `-d`：显示磁盘统计信息。

## 字段含义

```shell
procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo    in   cs  us  sy  id  wa  st
 0  0      0 1038756  99464 978408    0    0     0     1    45  306   5   1  94   0   0
 0  0      0 1035496  99464 978412    0    0     0    16  1104 2518   5   1  94   0   0
r：排队等待 CPU 调度的进程数。
b：处于不可中断状态（blocked）的进程数。
swpd：已使用的虚拟内存交换空间大小，即虚拟内存使用总量（单位为 KB）。
free：空闲的物理内存大小（单位为 KB）。
buff：用作缓存的内存大小（单位为 KB）。
cache：用作高速缓存的内存大小（单位为 KB）。

si：从磁盘读入交换页的速度（单位为 KB/s）。
so：把交换页写到磁盘的速度（单位为 KB/s）。

bi：从块设备（磁盘）读入的块数（单位为 1KB/s）。
bo：输出（写）到块设备（磁盘）的块数（单位为 1KB/s）。

in：每秒中断的数量。
cs：每秒上下文切换的数量。

us：用户 CPU 时间占用百分比。
sy：内核 CPU 时间占用百分比。
id：空闲 CPU 时间百分比。
wa：等待 I/O 操作完成的 CPU 时间百分比。
st：由于 hypervisor 需要导出虚拟 CPU 给虚拟机，导致虚拟机等待 CPU 时间的百分比。
```



## 实例

1. 显示每秒的 CPU 上下文切换次数和 CPU 使用率：

```
vmstat 1 5
```

以上命令表示每隔一秒采样一次数据，共采样 5 次，输出结果中包含 CPU 上下文切换次数和 CPU 使用率等信息。

1. 显示内存使用情况：

```
vmstat -s
```

以上命令用来显示内存总量、空闲内存、已使用内存和缓冲区、缓存的内存等信息。

1. 显示磁盘统计信息：

```
vmstat -d
```

以上命令用来显示磁盘读写速率、磁盘阻塞次数、I/O 请求等信息。

```shell
#vmstat -d
disk- ------------reads------------ ------------writes----------- -----IO------
       total merged sectors      ms  total merged sectors      ms    cur    sec
nvme0n1 1908647  13825 98693242  270188 14930197 275495 11542964320 2559325216      0   6221
sda   20752870 679770 5400761313 273230592 4959935   8362 5052433608 297034814      0  68519
dm-0  1908378      0 98525158  269509 15116567      0 11562054640 2561719427      0   5308
dm-1   13096      0  108472    2623  89070      0  712560 2702737      0     11

reads，writes：在这两行中输出读写操作的统计信息。
total：读写操作的总次数。
merged：操作合并的总次数，即多个操作在短时间内执行的次数。
sectors：数据传输的总字节数。
ms：数据传输的总时间。
------IO------：在这行中输出磁盘 I/O 统计信息。
cur：表示当下的活跃 I/O 请求
sec：I/O 请求总时间（单位是微秒）。
```



# uptime

![2_15.png](https://piggo-picture.oss-cn-hangzhou.aliyuncs.com/2_15-100522188-orig.png)

小数代表过去1分钟、5分钟、15分钟cpu平均负载；可以分析高负载是暂时的，还是长期的。但什么是高负载呢？数字代表请求cpu资源的任务量，1.0代表一个100%的cpu核的资源；超过1.0的部分代表等待cpu处理的进程量。

需要说明的是，这些数字和cpu核数相关，如果有4个cpu，4.0才意味着所有核完全被占用。通常70%是比较健康的状态，即每个cpu核负载0.7。



