# ssh隧道和sock代理


1. 在 MacBook 上配置代理：

      **开启远程登录**：这是让MacBook能接受SSH连接的前提。

      - 进入 **系统偏好设置** > **共享**。
      - 勾选 **远程登录**。允许访问的用户可以选择“所有用户”或特定管理员用户。
      - 记下界面中显示的您的MacBook在当前局域网内的IP地址（形如 `192.168.1.x`）。ipconfig getifaddr en0
      - sudo sysctl -w net.inet.ip.forwarding=1

2. 服务器上建立 SSH 隧道，将服务器的 ssh 流量通过 SSH 隧道转发到笔记本
      ssh -N -D 1080 username@笔记本的内网IP   ssh -N -D 1080 chengxingfu@172.20.10.2

      >  -D 1080选项正是在服务器本地（127.0.0.1）开启了一个 SOCKS5 代理服务，端口为1080。所有发送到这个端口的流量，都会通过SSH隧道加密转发到MacBook，再由MacBook以其自身的网络连接发出。

      或者提高成功率：ssh -N -D 127.0.0.1:1080 username@MAC_IP \
          -o ServerAliveInterval=30 \
          -o ServerAliveCountMax=3


      该命令等待输入密码，然后挂在那里，用下面命令验证是否成功：
      ss -lntp | grep 1080  

3. 在 OpenEuler 服务器上使用代理：

  - 对于命令行工具，如  curl  或  wget ，使用以下方式访问外网：
    curl --socks5 127.0.0.1:1080 http://example.com

  - 全局代理

    export http_proxy=socks5://127.0.0.1:1080
    export https_proxy=socks5://127.0.0.1:1080

    export all_proxy=socks5h://127.0.0.1:1080

## 为 dnf/yum 单独配置代理

openEuler 使用的是 **dnf**（兼容 yum）：

```shell
sudo tee -a /etc/dnf/dnf.conf <<EOF
proxy=socks5h://127.0.0.1:1080
timeout=60
EOF
```







# 共享网络

步骤：
	1.	连接服务器和笔记本：
使用网线将服务器的网口与笔记本的网口直连，或通过交换机连接。
	2.	在 MacBook 上启用网络共享：
		•	打开系统偏好设置，选择“共享”。
	•	在左侧列表中勾选“互联网共享”。
	•	在“共享以下来源的连接”中选择您的外网连接（如 Wi-Fi）。
	•	在“用以下端口共享给电脑”中选择服务器连接的网口（如 Thunderbolt Bridge）。
	•	点击“启动”按钮，系统会提示您确认，点击“确定”。
	3.	配置 OpenEuler 服务器的网络：
	•	将服务器的网关设置为笔记本的 IP 地址（通常在  192.168.2.0/24  网段）。
	•	设置服务器的 DNS 为  8.8.8.8  或  114.114.114.114 。

# mac 做 socks5 代理

1. mac 启动 socks5

   - 系统设置 → 通用 → 共享 → 远程登录,ssh -N -D 1080 localhost      

   - 或者 使用 dante

     ```shell
     sudo tee /usr/local/etc/sockd.conf <<EOF
     logoutput: stderr
     internal: 0.0.0.0 port = 1080
     external: en0
     method: none
     user.privileged: root
     user.unprivileged: nobody
     client pass {
         from: 0.0.0.0/0 to: 0.0.0.0/0
     }
     pass {
         from: 0.0.0.0/0 to: 0.0.0.0/0
     }
     EOF
     
     # 启动
     sudo sockd -D
     ```

     

2. openEuler 设置代理
   ```shell
   
   export http_proxy=socks5://MAC_IP:1080
   export https_proxy=socks5://MAC_IP:1080
   export all_proxy=socks5://MAC_IP:1080
   
   ```

   持久化
   ```shell
   cat >> /etc/profile <<EOF
   export all_proxy=socks5://MAC_IP:1080
   EOF
   ```

3. dns 修正
   cat /etc/resolv.conf 若无 DNS
   echo -e "nameserver 8.8.8.8\nnameserver 114.114.114.114" > /etc/resolv.conf

4. 验证
   ```shell
   curl http://example.com
   dnf install -y vim
   ```

   



