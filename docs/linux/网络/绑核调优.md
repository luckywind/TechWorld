# 绑核调优

本质就是队列中断和netperf的进程不要分在同core上，同时要尽可能保证每条流量中断core和netperf的应用core为相邻关系；



性能调优测试中发现海光CPU，只有在应用核与中断核在相邻4个cores时（同L3下的cores为相邻核），单核的性能测试结果最高，同时也相对稳定。因此性能测试时需要尽可能的计算出每条流经过hash运算后，该流量中断使用的core，确定该流的中断核后，同时将应用核绑定在中断核的相邻位置，以此测试出网卡的最优，最稳定的性能指标。

## 中断绑核

1. 查看队列

`ethtool -l enp5s0f0`    

Channel parameters for enp5s0f0:
Pre-set maximums:
RX:		n/a
TX:		n/a
Other:		n/a
Combined:	48
Current hardware settings:
RX:		n/a
TX:		n/a
Other:		n/a
Combined:	8

2. 找到队列中断号

`root@h012:~# ethtool -i enp5s0f0`  看pci地址
`root@h012:~# cat /proc/interrupts |grep 05:00.0`

![image-20250731150909071](https://piggo-picture.oss-cn-hangzhou.aliyuncs.com/image-20250731150909071.png)

3. 各队列中断绑核

`echo ${core} /proc/irq/${队列号}/smp_affinity_list`

## 应用绑核

通过taskset

