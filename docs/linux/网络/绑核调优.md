# 绑核调优

本质就是队列中断和netperf的进程不要分在同core上，同时要尽可能保证每条流量中断core和netperf的应用core为相邻关系；



性能调优测试中发现海光CPU，只有在应用核与中断核在相邻4个cores时（同L3下的cores为相邻核），单核的性能测试结果最高，同时也相对稳定。因此性能测试时需要尽可能的计算出每条流经过hash运算后，该流量中断使用的core，确定该流的中断核后，同时将应用核绑定在中断核的相邻位置，以此测试出网卡的最优，最稳定的性能指标。

## 中断绑核

1. **查看队列**

`ethtool -l enp5s0f0`    

Channel parameters for enp5s0f0:
Pre-set maximums:
RX:		n/a
TX:		n/a
Other:		n/a
Combined:	48
Current hardware settings:
RX:		n/a
TX:		n/a
Other:		n/a
Combined:	8

2. **找到队列中断号**

`root@h012:~# ethtool -i enp5s0f0`  看pci地址
`root@h012:~# cat /proc/interrupts |grep 05:00.0`

![image-20250731150909071](https://piggo-picture.oss-cn-hangzhou.aliyuncs.com/image-20250731150909071.png)

以列说明，依次为队列中断号，cpu核 中断类型，队列。

3. **查看中断绑定的核**

以中断号142为例：

```shell
cat /proc/irq/142/smp_affinity
00080000
```

cpu核从0开始，80000的二进制上的每一位代表一个cpu核。80000 的二进制是 100111000100000000。

4. **各队列中断绑核**

`echo ${core} > /proc/irq/${队列号}/smp_affinity_list`， 

还有一种以二进制方式绑定的

`echo ${core二进制}  > /proc/irq/142/smp_affinity`  例如`echo 100 > /proc/irq/142/smp_affinity` 表示把142绑定到8核上

例如

```shell
echo 31 >/proc/irq/142/smp_affinity_list

#以下两个文件被同步修改
cat /proc/irq/142/smp_affinity_list
31
cat /proc/irq/142/smp_affinity
80000000
```







## 应用绑核

通过taskset

