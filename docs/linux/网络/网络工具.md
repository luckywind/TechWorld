# ip
## help

ip help
Usage:` ip [ OPTIONS ] OBJECT { COMMAND | help }` å¯¹è±¡åé¢é™¤äº†å†™COMMANDï¼Œè¿˜å¯ä»¥help
       ip [ -force ] -batch filename
ğŸ“Œ**OPTIONS** := { -V[ersion] | -s[tatistics] | -d[etails] | -r[esolve] |
                    -h[uman-readable] |

â€‹		     -iec ä½¿ç”¨ IEC å•ä½(1Ki=1024)|
â€‹                    -f[amily] { inet | inet6 | ipx | dnet | mpls | bridge | link } | -4 | -6 | -I | -D | -B | -0 |
â€‹                    -l[oops] { maximum-addr-flush-attempts } |

â€‹		     -br[ief]    **è¡¨æ ¼åŒ–è¾“å‡º**|
â€‹                    -o[neline] **å•è¡Œè¾“å‡º**| -t[imestamp] | -ts[hort] | -b[atch] [filename] |
â€‹                    -rc[vbuf] [size] |

â€‹                    -n[etns] name ç½‘ç»œå‘½åç©ºé—´|

â€‹                    -a[ll] | 

â€‹                    -c[olor]  å½©è‰²è¾“å‡º}

ğŸ“Œ **OBJECT** := { 

-  link ç½‘ç»œæ¥å£| 
- address IP åœ°å€| addrlabel | 
- route  è·¯ç”±è¡¨| 
- rule è·¯ç”±ç­–ç•¥ | 
- neigh arp/ndp é‚»å±…è¡¨| 
-  ntable  é‚»å±…è¡¨é…ç½®|
-  netns å‘½åç©ºé—´
-  tunnel | tuntap | maddress | mroute | mrule | monitor | xfrm |
                      | l2tp | fou | macsec | tcp_metrics | token | netconf | ila |
                     vrf }



ğŸ“Œ**COMMAND**:

|    å‘½ä»¤     |   åŠŸèƒ½   |                   ç¤ºä¾‹                    |
| :---------: | :------: | :---------------------------------------: |
|  **show**   | æ˜¾ç¤ºä¿¡æ¯ |              `ip link show`               |
|  **list**   | åˆ—è¡¨æ˜¾ç¤º |              `ip addr list`               |
|   **add**   | æ·»åŠ é…ç½® |   `ip addr add 192.168.1.1/24 dev eth0`   |
|   **del**   | åˆ é™¤é…ç½® |   `ip addr del 192.168.1.1/24 dev eth0`   |
|   **set**   | ä¿®æ”¹å±æ€§ |        `ip link set eth0 mtu 9000`        |
| **change**  | ä¿®æ”¹é…ç½® | `ip route change default via 192.168.1.1` |
| **replace** | æ›¿æ¢é…ç½® | `ip addr replace 192.168.1.2/24 dev eth0` |
|  **flush**  | æ¸…é™¤é…ç½® |         `ip neigh flush dev eth0`         |
|  **help**   | å¯¹è±¡å¸®åŠ© |              `ip route help`              |



## ç½‘ç»œæ¥å£ä¿¡æ¯

	ip link set { DEVICE | dev DEVICE | group DEVGROUP }
			[ { up | down } ]

| åŠŸèƒ½         | å‘½ä»¤                                | è¯´æ˜                      |
| ------------ | ----------------------------------- | ------------------------- |
| æŸ¥çœ‹æ‰€æœ‰æ¥å£ | `ip link`                           | ç±»ä¼¼ `ifconfig -a`,  ip a |
| æŸ¥çœ‹æ¥å£çŠ¶æ€ | `ip link show dev eth0`             | æŸ¥çœ‹æŒ‡å®šæ¥å£çš„çŠ¶æ€ä¿¡æ¯    |
| å¯ç”¨æ¥å£     | `ip link set dev eth0 up`           | å¯åŠ¨ç½‘å¡                  |
| ç¦ç”¨æ¥å£     | `ip link set dev eth0 down`         | å…³é—­ç½‘å¡                  |
| è®¾ç½®ä¸»ä»å…³ç³» | `ip link set dev eth0 master bond0` |                           |
| ä¿®æ”¹ MTU     | `ip link set dev eth0 mtu 1400`     | è®¾ç½®æœ€å¤§ä¼ è¾“å•å…ƒ          |
| åˆ é™¤ç½‘ç»œæ¥å£ | `ip link delete <device>`           |                           |
| åˆ›å»ºç½‘ç»œæ¥å£ | `ip link add <name>`                |                           |

æ¯ä¸ªç½‘å¡ï¼ˆNICï¼‰éƒ½è¢«åˆ†é…äº†å”¯ä¸€çš„åç§°ï¼Œå¦‚ ethXã€enpXXX ç­‰ã€‚

- æ—§çš„ Linux å‘è¡Œç‰ˆä½¿ç”¨çš„æ˜¯ `eth[X]` æ ¼å¼ã€‚ä¾‹å¦‚ï¼ŒRHEL 6 å’Œå®ƒä»¬çš„æ—§ç‰ˆæœ¬ã€‚
- ç°ä»£çš„ Linux å‘è¡Œç‰ˆä½¿ç”¨ `enp[XXX]` æˆ– `ens[XXX]` æ ¼å¼



`ip link add <name> type <link_type> [options] `åˆ›å»ºç½‘ç»œæ¥å£

> ä¾‹å¦‚æ·»åŠ bondæ¥å£
>
> ip link add bond6 type bond mode balance-alb miimon 200 

`ip link set enp1s0f0 vf 0 rate 1000 ` vfæµé‡é™é€Ÿ

`ip link set DEVNAME vf 0 vlan 10` vf é…ç½®vlan

`ip maddr add 01:00.5e:01:02:02 dev enp1s0f0v0`  æ·»åŠ ç»„æ’­macåœ°å€

### ip link ç¤ºä¾‹

```shell
$ ip link show up
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: enp3s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether 04:7c:16:52:b8:f6 brd ff:ff:ff:ff:ff:ff
3: virbr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default qlen 1000
    link/ether 52:54:00:56:e1:82 brd ff:ff:ff:ff:ff:ff
5: br-45dccc0b0135: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default
    link/ether 02:42:09:fd:1e:14 brd ff:ff:ff:ff:ff:ff
6: br-4e68be08f0a4: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default
    link/ether 02:42:ed:d7:26:b8 brd ff:ff:ff:ff:ff:ff
7: br-765ac6315308: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default
    link/ether 02:42:14:7a:9b:64 brd ff:ff:ff:ff:ff:ff
8: br-a5f8fc186b55: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default
    link/ether 02:42:02:fa:0e:f7 brd ff:ff:ff:ff:ff:ff
9: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default
    link/ether 02:42:9b:4b:a0:bc brd ff:ff:ff:ff:ff:ff
11: vethf7b55b1@if10: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT group default
    link/ether 3e:6b:40:9b:e1:7a brd ff:ff:ff:ff:ff:ff link-netnsid 0
22903: vethb5023e8@if22902: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT group default
    link/ether 12:3d:32:95:75:21 brd ff:ff:ff:ff:ff:ff link-netnsid 2
22715: veth583e772@if22714: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT group default
    link/ether b6:43:31:e1:f2:3c brd ff:ff:ff:ff:ff:ff link-netnsid 1
36541: veth4773535@if36540: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT group default
    link/ether fe:6c:b2:57:23:c9 brd ff:ff:ff:ff:ff:ff link-netnsid 4
36557: veth27c4289@if36556: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT group default
    link/ether 4a:3e:30:6a:3c:b2 brd ff:ff:ff:ff:ff:ff link-netnsid 6
36579: veth71a2a75@if36578: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT group default
    link/ether da:4d:14:ed:6e:6e brd ff:ff:ff:ff:ff:ff link-netnsid 5
36599: veth6d8a073@if36598: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT group default
    link/ether 4a:b4:06:89:bb:65 brd ff:ff:ff:ff:ff:ff link-netnsid 3
```



```mermaid
graph TD
    A[æ¥å£åˆ†ç±»] --> B[ç‰©ç†æ¥å£]
    A --> C[è™šæ‹Ÿæ¥å£]
    A --> D[å®¹å™¨ç½‘ç»œ]
    
    B --> B1[enp3s0]
    C --> C1[lo]
    C --> C2[virbr0]
    D --> D1[Dockerç½‘æ¡¥]
    D --> D2[vethè®¾å¤‡]
```

**æ¯ä¸ªæ¥å£æœ‰ä¸¤è¡Œ**ï¼š

1. æ‘˜è¦ï¼š`<æ¥å£ç´¢å¼•>: <æ¥å£å>: <çŠ¶æ€æ ‡å¿—> mtu <MTUå€¼> qdisc <é˜Ÿåˆ—è§„åˆ™> state <çŠ¶æ€> mode <æ¨¡å¼> group <ç»„> [qlen <é˜Ÿåˆ—é•¿åº¦>]`
2. è¯¦ç»†ï¼š`    link/ether <MACåœ°å€> brd <å¹¿æ’­åœ°å€> [é™„åŠ ä¿¡æ¯]`

```mermaid
graph LR
    Host[å®¿ä¸»æœº] -->|vethè®¾å¤‡| Container1[å®¹å™¨1]
    Host -->|vethè®¾å¤‡| Container2[å®¹å™¨2]
    Host -->|vethè®¾å¤‡| Container3[å®¹å™¨3]
    Host --> Docker0[Dockerç½‘æ¡¥]
    
    Docker0 --> Internet[å¤–éƒ¨ç½‘ç»œ]
    Docker0 -->|è·¯ç”±| enp3s0[ç‰©ç†ç½‘å¡]
    
    Container1 -->|é€šè¿‡docker0| Internet
    Container2 -->|é€šè¿‡docker0| Internet
```

**vethè®¾å¤‡**

`11: vethf7b55b1@if10: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT group default
    link/ether 3e:6b:40:9b:e1:7a brd ff:ff:ff:ff:ff:ff link-netnsid 0`

- **å‘½åè§„åˆ™**ï¼š`veth` + éšæœºID + `@if` + å¯¹ç«¯æ¥å£ç´¢å¼•
- **master**ï¼šç»‘å®šåˆ°docker0ç½‘æ¡¥
- **link-netnsid**ï¼šè¿æ¥åˆ°ç½‘ç»œå‘½åç©ºé—´ID 0ï¼ˆå®¹å™¨ï¼‰
- **ä½œç”¨**ï¼šè¿æ¥å®¹å™¨ä¸å®¿ä¸»æœºç½‘ç»œ

çŠ¶æ€æ ‡è®°

|     æ ‡å¿—     |      å«ä¹‰      |   ç¤ºä¾‹æ¥å£   |
| :----------: | :------------: | :----------: |
|  `LOOPBACK`  |    å›ç¯æ¥å£    |      lo      |
| `BROADCAST`  |    æ”¯æŒå¹¿æ’­    |    enp3s0    |
| `MULTICAST`  |    æ”¯æŒç»„æ’­    |    enp3s0    |
|     `UP`     |   æ¥å£å·²å¯ç”¨   | æ‰€æœ‰æ˜¾ç¤ºæ¥å£ |
|  `LOWER_UP`  | ç‰©ç†é“¾è·¯å·²è¿æ¥ |    enp3s0    |
| `NO-CARRIER` |   æ— ç‰©ç†è¿æ¥   |    virbr0    |



## addr: ipåœ°å€ç®¡ç†

| åŠŸèƒ½           | å‘½ä»¤                                     | è¯´æ˜               |
| -------------- | ---------------------------------------- | ------------------ |
| æŸ¥çœ‹ IP åœ°å€   | `ip addr` æˆ– `ip a`                      | æ˜¾ç¤ºæ‰€æœ‰æ¥å£çš„ IP  |
| æŸ¥çœ‹æŸæ¥å£åœ°å€ | `ip addr show dev eth0`                  |                    |
| æ·»åŠ  IP åœ°å€   | `ip addr add 192.168.1.100/24 dev eth0`  | æ·»åŠ ä¸€ä¸ª IPv4 åœ°å€ |
| åˆ é™¤ IP åœ°å€   | `ip addr del 192.168.1.100/24 dev eth0`  | åˆ é™¤ IPv4 åœ°å€     |
| æ·»åŠ  IPv6 åœ°å€ | `ip -6 addr add 2001:db8::1/64 dev eth0` | æ·»åŠ  IPv6 åœ°å€     |

 ens4f1: <**NO-CARRIER**,BROADCAST,MULTICAST,UP> mtu 1500 qdisc mq state DOWN group default qlen 1000

NO-CARRIERï¼š æœªè¿æ¥ç½‘çº¿

## route è·¯ç”±ç®¡ç†

### åŸºæœ¬å‘½ä»¤

ip route add <ç½‘ç»œ> via <ç½‘å…³> [dev <å‡ºå£ç½‘å¡>]

> è¿™é‡Œçš„<ç½‘ç»œ>å¯ä»¥æ˜¯ç›®æ ‡ä¸»æœºï¼Œä¹Ÿå¯ä»¥æ˜¯ç›®æ ‡ç½‘ç»œ/æ©ç 
>
> å‡ºå£ç½‘å¡å¯é€‰

ip route del <ç½‘ç»œ>
ip route get <IP>

| åŠŸèƒ½         | å‘½ä»¤                                          | è¯´æ˜             |
| ------------ | --------------------------------------------- | ---------------- |
| æŸ¥çœ‹è·¯ç”±è¡¨   | `ip route` æˆ– `ip r`ï¼Œ  æ—§å‘½ä»¤`route -n`      | æ˜¾ç¤ºä¸»è·¯ç”±è¡¨     |
| æ·»åŠ è·¯ç”±     | `ip route add 192.168.2.0/24 via 192.168.1.1` | æ·»åŠ ä¸€æ¡é™æ€è·¯ç”± |
| åˆ é™¤è·¯ç”±     | `ip route del 192.168.2.0/24`                 | åˆ é™¤ä¸€æ¡é™æ€è·¯ç”± |
| é»˜è®¤è·¯ç”±     | `ip route add default via 192.168.1.1`        | è®¾ç½®é»˜è®¤ç½‘å…³     |
| æŒ‡å®šæ¥å£è·¯ç”± | `ip route add 10.0.0.0/24 dev eth1`           | æ— éœ€ç½‘å…³         |

è·¯ç”±æ˜¯ç½‘ç»œå±‚çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæœ¬è´¨æ˜¯**æ•°æ®åŒ…è½¬å‘å†³ç­–ç³»ç»Ÿ**ã€‚å½“è®¾å¤‡å‘é€IPæ•°æ®åŒ…æ—¶ï¼Œè·¯ç”±è¡¨å†³å®šï¼š

1. **æ˜¯å¦å¯è¾¾**ï¼šç›®æ ‡åœ°å€æ˜¯å¦åœ¨è·¯ç”±è¡¨ä¸­
2. **ä¸‹ä¸€è·³**ï¼šé€šè¿‡å“ªä¸ªç½‘å…³è½¬å‘
3. **å‡ºå£**ï¼šä»å“ªä¸ªç½‘ç»œæ¥å£å‘å‡º

$ ip r
default via 192.168.22.1 dev enp4s0 proto static metric 100
10.0.2.0/24 dev enp1s0f1 proto kernel scope link src 10.0.2.71
10.0.3.0/24 dev enp1s0f1v0 proto kernel scope link src 10.0.3.10
122.199.10.0/24 dev enp1s0f0 proto kernel scope link src 122.199.10.171 metric 101
169.254.0.0/16 dev enp4s0 scope link metric 1000
192.168.22.0/24 dev enp4s0 proto kernel scope link src 192.168.22.171 metric 100

### å‘½ä»¤å¸®åŠ©

$ip route help

âœ…å‘½ä»¤

Usage: ip route { list | flush } SELECTOR
       ip route save SELECTOR
       ip route restore
       ip route showdump
       ip route get [ ROUTE_GET_FLAGS ] ADDRESS
                            [ from ADDRESS iif STRING ]
                            [ oif STRING ] [ tos TOS ]
                            [ mark NUMBER ] [ vrf NAME ]
                            [ uid NUMBER ] [ ipproto PROTOCOL ]
                            [ sport NUMBER ] [ dport NUMBER ]
       ip route { add | del | change | append | replace } ROUTE

âœ…é€‰æ‹©å™¨

SELECTOR := [ root PREFIX ] [ match PREFIX ] [ exact PREFIX ]
            [ table TABLE_ID ] [ vrf NAME ] [ proto RTPROTO ]
            [ type TYPE ] [ scope SCOPE ]
ROUTE := NODE_SPEC [ INFO_SPEC ]

âœ…è·¯ç”±å®šä¹‰

- ç›®æ ‡ç½‘ç»œå®šä¹‰

NODE_SPEC := [ TYPE ] PREFIX [ tos TOS ]
             [ table TABLE_ID ] [ proto RTPROTO ]
             [ scope SCOPE ] [ metric METRIC ]
             [ ttl-propagate { enabled | disabled } ]

- è·¯å¾„å®šä¹‰

INFO_SPEC := { NH | nhid ID } OPTIONS FLAGS [ nexthop NH ]...

ä¸‹ä¸€è·³(Next Hop)

NH := [ encap ENCAPTYPE ENCAPHDR ] [ via [ FAMILY ] ADDRESS ]
	    [ dev STRING ] [ weight NUMBER ] NHFLAGS
FAMILY := [ inet | inet6 | mpls | bridge | link ]
OPTIONS := FLAGS [ mtu NUMBER ] [ advmss NUMBER ] [ as [ to ] ADDRESS ]
           [ rtt TIME ] [ rttvar TIME ] [ reordering NUMBER ]
           [ window NUMBER ] [ cwnd NUMBER ] [ initcwnd NUMBER ]
           [ ssthresh NUMBER ] [ realms REALM ] [ src ADDRESS ]
           [ rto_min TIME ] [ hoplimit NUMBER ] [ initrwnd NUMBER ]
           [ features FEATURES ] [ quickack BOOL ] [ congctl NAME ]
           [ pref PREF ] [ expires TIME ] [ fastopen_no_cookie BOOL ]

è·¯ç”±ç±»å‹

TYPE := { unicast | local | broadcast | multicast | throw |
          unreachable | prohibit | blackhole | nat }

è·¯ç”±è¡¨ï¼š

TABLE_ID := [ local | main | default | all | NUMBER ]

ä½œç”¨åŸŸ

SCOPE := [ host | link | global | NUMBER ]
NHFLAGS := [ onlink | pervasive ]

è·¯ç”±åè®®

RTPROTO := [ kernel | boot | static | NUMBER ]
PREF := [ low | medium | high ]
TIME := NUMBER[s|ms]
BOOL := [1|0]
FEATURES := ecn
ENCAPTYPE := [ mpls | ip | ip6 | seg6 | seg6local ]
ENCAPHDR := [ MPLSLABEL | SEG6HDR ]
SEG6HDR := [ mode SEGMODE ] segs ADDR1,ADDRi,ADDRn [hmac HMACKEYID] [cleanup]
SEGMODE := [ encap | inline ]
ROUTE_GET_FLAGS := [ fibmatch ]

## netns

Namespace å°±åƒæ˜¯â€œè™šæ‹Ÿçš„éš”ç¦»æˆ¿é—´â€ï¼Œ æ¯ä¸ªæˆ¿é—´é‡Œçš„è¿›ç¨‹åªèƒ½çœ‹åˆ°è‡ªå·±çš„ç½‘ç»œã€è¿›ç¨‹ã€æŒ‚è½½ç‚¹ã€ä¸»æœºåç­‰ã€‚

Usage:	

â€‹	ip netns list         æŸ¥
â€‹	ip netns add NAME  å¢
â€‹	ip netns attach NAME PID
â€‹	ip netns set NAME NETNSID
â€‹	ip [-all] netns delete [NAME]  åˆ 
â€‹	ip netns identify [PID]
â€‹	ip netns pids NAME
â€‹	ip [-all] netns exec [NAME] cmd ...  æ‰§è¡Œå‘½ä»¤
â€‹	ip netns monitor
â€‹	ip netns list-id [target-nsid POSITIVE-INT] [nsid POSITIVE-INT]  



```shell
[root@localhost ~]# ip netns add ns1
[root@localhost ~]# ip netns list
ns1
[root@localhost ~]# ifconfig ens4f1 down
[root@localhost ~]# ip link set ens4f1 netns ns1
[root@localhost ~]# ip netns exec ns1 ip a show
1: lo: <LOOPBACK> mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
7: ens4f1: <BROADCAST,MULTICAST> mtu 9000 qdisc noop state DOWN mode DEFAULT group default qlen 1000
    link/ether 74:3e:39:20:06:b7 brd ff:ff:ff:ff:ff:ff
[root@localhost ~]# ip netns exec ns1 ip addr add 1.1.1.2/24 dev ens4f1
[root@localhost ~]# ip netns exec ns1 ip link set ens4f1 up
[root@localhost ~]# ip netns exec ns1 ip link set lo up
ip netns exec ns1 ip a  å¯ä»¥çœ‹åˆ°ip å·²ç»åŠ ä¸Šï¼Œip link ä¸æ˜¾ç¤ºip




```







# ifconfig

`ifconfig`ï¼ˆinterface configuratorï¼‰æ˜¯ Linux å’Œç±» Unix ç³»ç»Ÿä¸­çš„ä¼ ç»Ÿç½‘ç»œé…ç½®å·¥å…·ï¼Œç”¨äºæŸ¥çœ‹å’Œé…ç½®ç½‘ç»œæ¥å£çš„åœ°å€å’ŒçŠ¶æ€ã€‚

| åº”ç”¨åœºæ™¯                | å‘½ä»¤ç¤ºä¾‹                                            | è¯´æ˜                                     |
| ----------------------- | --------------------------------------------------- | ---------------------------------------- |
| æŸ¥çœ‹æ‰€æœ‰ç½‘å¡çŠ¶æ€        | `ifconfig`                                          | æ˜¾ç¤ºæ‰€æœ‰å·²æ¿€æ´»ï¼ˆUPï¼‰çš„æ¥å£ä¿¡æ¯           |
| æŸ¥çœ‹æŒ‡å®šæ¥å£çŠ¶æ€        | `ifconfig eth0`                                     | æŸ¥çœ‹ eth0 çš„è¯¦ç»†ä¿¡æ¯                     |
| å¯ç”¨ç½‘å¡                | `ifconfig eth0 up`                                  | æ¿€æ´»ç½‘å¡ï¼ˆç­‰æ•ˆäº `ip link set eth0 up`ï¼‰ |
| ç¦ç”¨ç½‘å¡                | `ifconfig eth0 down`                                | ç¦ç”¨ç½‘å¡                                 |
| è®¾ç½® IP åœ°å€            | `ifconfig eth0 192.168.1.100`                       | è®¾ç½® IPv4 åœ°å€                           |
| è®¾ç½® IP+å­ç½‘æ©ç         | `ifconfig eth0 192.168.1.100 netmask 255.255.255.0` | åŒæ—¶è®¾ç½® IP å’Œå­ç½‘æ©ç                    |
| æ·»åŠ å¹¿æ’­åœ°å€            | `ifconfig eth0 broadcast 192.168.1.255`             | æ˜¾å¼è®¾ç½®å¹¿æ’­åœ°å€                         |
| è®¾ç½® MAC åœ°å€ï¼ˆéœ€æƒé™ï¼‰ | `ifconfig eth0 hw ether 00:11:22:33:44:55`          | ä¿®æ”¹ MAC åœ°å€ï¼ˆä¸´æ—¶ï¼‰                    |
| è®¾ç½® MTU                | `ifconfig eth0 mtu 1400`                            | ä¿®æ”¹æœ€å¤§ä¼ è¾“å•å…ƒå¤§å°                     |
| æ¸…é™¤æ‰€æœ‰è®¾ç½®ï¼ˆæ…ç”¨ï¼‰    | `ifconfig eth0 0.0.0.0`                             | æ¸…é™¤æ¥å£ IP                              |

`ifconfig` ä¸ä¼šæ˜¾ç¤º **æœªå¯ç”¨çš„æ¥å£**ï¼Œå¯ä»¥ä½¿ç”¨ `ip link` æˆ– `ifconfig -a` æŸ¥çœ‹å…¨éƒ¨ã€‚

æ–°ç³»ç»Ÿå»ºè®®ä½¿ç”¨ `ip` å‘½ä»¤æ›¿ä»£ `ifconfig`ï¼ˆå¦‚ `ip addr`ã€`ip link`ï¼‰ã€‚



# ethtool

## å¸¸ç”¨

`ethtool` ç”¨äºæŸ¥çœ‹å’Œä¿®æ”¹ç½‘ç»œè®¾å¤‡ï¼ˆå°¤å…¶æ˜¯æœ‰çº¿ä»¥å¤ªç½‘è®¾å¤‡ï¼‰çš„é©±åŠ¨å‚æ•°å’Œç¡¬ä»¶è®¾ç½®
[å‚è€ƒ](https://zhuanlan.zhihu.com/p/146383216)

- **[åŠåŒå·¥](https://zhida.zhihu.com/search?content_id=120662519&content_type=Article&match_order=1&q=åŠåŒå·¥&zhida_source=entity)**ï¼šåŠåŒå·¥æ¨¡å¼å…è®¸è®¾å¤‡ä¸€æ¬¡åªèƒ½å‘é€æˆ–æ¥æ”¶æ•°æ®åŒ…ã€‚
- **[å…¨åŒå·¥](https://zhida.zhihu.com/search?content_id=120662519&content_type=Article&match_order=1&q=å…¨åŒå·¥&zhida_source=entity)**ï¼šå…¨åŒå·¥æ¨¡å¼å…è®¸è®¾å¤‡å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®åŒ…ã€‚
- **è‡ªåŠ¨åå•†**ï¼šè‡ªåŠ¨åå•†æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸è®¾å¤‡è‡ªåŠ¨é€‰æ‹©æœ€ä½³ç½‘é€Ÿå’Œå·¥ä½œæ¨¡å¼ï¼ˆå…¨åŒå·¥æˆ–åŠåŒå·¥æ¨¡å¼ï¼‰ã€‚
- **é€Ÿåº¦**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šä½¿ç”¨æœ€å¤§é€Ÿåº¦ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ”¹å˜å®ƒã€‚

```shell
ethtool enp3s0  #ç½‘å¡ä¿¡æ¯ï¼Œæ”¯æŒçš„fecç±»å‹
ethtool -i(info) enp3s0 #é©±åŠ¨ç¨‹åºç‰ˆæœ¬ã€å›ºä»¶ç‰ˆæœ¬å’Œæ€»çº¿çš„è¯¦ç»†ä¿¡æ¯
ethtool -S(stat) enp3s0 # ç½‘ç»œä½¿ç”¨æƒ…å†µç»Ÿè®¡
ethtool -a(autoneg) enp3s0 #æŸ¥çœ‹è‡ªåŠ¨åå•†ã€RXã€TXç­‰è¯¦ç»†ä¿¡æ¯

ethtool -p(physical) enp3s0 # LEDé—ªçƒ30sï¼Œç”¨äºè¯†åˆ«ç‰©ç†æ¥å£

ethtool -k(kernel offload) enp3s0 # æŸ¥çœ‹åŠŸèƒ½å¸è½½çŠ¶æ€
ethtool -K enp3s0 <feature> [on|off]  # å¸è½½åŠŸèƒ½å¼€å…³

ethtool -g(getring) enp3s0 # æŸ¥çœ‹rx bufferè®¾ç½®	Query RX/TX ring parameters
ethtool -G(grow/Give new size) enp3s0 tx 4096 tx 4096 # è®¾ç½®æ¥æ”¶é˜Ÿåˆ—

ethtool -l enp3s0   #æŸ¥çœ‹ç½‘å¡é˜Ÿåˆ—é…ç½®
ethtool -L enp3s0 combined 4 #é…ç½®ç½‘å¡é˜Ÿåˆ—

ethtool -m enp3s0 #Query/Decode Module EEPROM information

ethtool --show-fec DEVNAME  #æŸ¥çœ‹ç½‘å¡è®¾ç½®çš„FECè®¾ç½®
ethtool --set-fec DEVNAME encoding rs/auto/off #è®¾ç½®FECï¼Œéœ€è¦è€ƒè™‘å¯¹ç«¯äº¤æ¢æœºé…ç½®å’Œè§„æ ¼


ethtool --set-priv-flags  enp3s0 disable-fw-lldp on / off # é…ç½®lldpå¼€å…³
```

**RSSæŠ¥æ–‡æ•£åˆ—é…ç½®**

ç½‘å¡é»˜è®¤æŒ‰ç…§äº”å…ƒç»„hashè¿›è¡ŒRSSï¼Œä½¿ç”¨toeplitzç®—æ³•ã€‚

æŸ¥çœ‹å½“å‰é…ç½®

`ethtool -n enp3s0 rx-flow-hash udp4`

é…ç½®ç½‘å¡udpåè®®æŒ‰ç…§ä¸‰å…ƒç»„è¿›è¡ŒRSSï¼š

`ethtool --config-ntuple ${interface} rx-flow-hash udp4 sdt `

é…ç½®ç½‘å¡udpåè®®æŒ‰ç…§äº”å…ƒç»„è¿›è¡ŒRSSï¼š

`ethtool --config-ntuple ${interface} rx-flow-hash udp4 sdtfn `

> - `s`ï¼šæº IP
> - `d`ï¼šç›®çš„ IP
> - `t`ï¼šç›®çš„ç«¯å£
> - `f`ï¼šæºç«¯å£ï¼ˆSource Portï¼‰
> - `n`ï¼šåè®®å·ï¼ˆProtocol Numberï¼‰



**ç½‘ç»œæ—¶é—´æˆ³**

```shell
ethtool -T enp3s0  #æŸ¥çœ‹ç½‘ç»œæ¥å£çš„æ—¶é—´æˆ³åŠŸèƒ½æ”¯æŒæƒ…å†µ
sudo yum install linuxptp
ptp4l -v
ä¸»æ—¶é’Ÿå¯åŠ¨(2å±‚)
ptp4l -i enp1s0f0 -2
ä»æ—¶é’Ÿå¯åŠ¨(2å±‚)
ptp4l -i enp1s0f0 -2 -s
ä¸»æ—¶é’Ÿå¯åŠ¨(4å±‚)
ptp4l -i enp1s0f0 -4
ä»æ—¶é’Ÿå¯åŠ¨(4å±‚)
ptp4l -i enp1s0f0 -4 -s
```

| å‚æ•° |            åŠŸèƒ½             |         ç¤ºä¾‹         |
| :--: | :-------------------------: | :------------------: |
| `-i` |        æŒ‡å®šç½‘ç»œæ¥å£         |     `-i enp3s0`      |
| `-m` |     æ‰“å°æ¶ˆæ¯åˆ°æ ‡å‡†è¾“å‡º      |         `-m`         |
| `-f` |        æŒ‡å®šé…ç½®æ–‡ä»¶         | `-f /etc/ptp4l.conf` |
| `-s` |         ä»æ—¶é’Ÿæ¨¡å¼          |         `-s`         |
| `-l` |        è®¾ç½®æ—¥å¿—çº§åˆ«         |        `-l 6`        |
| `-2` | ä½¿ç”¨ IEEE 1588-2008 (PTPv2) |         `-2`         |

## å…‰æ¨¡å—

ethtool -m enp33s0f0

Identifier                                : 0x03 (SFP)  # æ¨¡å—ç±»å‹ï¼šSFPï¼ˆå°å‹å¯æ’æ‹”ï¼‰
Extended identifier                       : 0x04 (GBIC/SFP defined by 2-wire interface ID)  # æ‰©å±•æ ‡è¯†ï¼šç¬¦åˆGBIC/SFPæ ‡å‡†ï¼Œä½¿ç”¨2çº¿æ¥å£ID
Connector                                 : 0x07 (LC)  # è¿æ¥å™¨ç±»å‹ï¼šLCï¼ˆæ ‡å‡†å…‰çº¤æ¥å£ï¼‰
Transceiver codes                         : 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x02  # æ”¶å‘å™¨ç¼–ç ï¼šå‚å•†ç‰¹å®šç¼–ç 
Transceiver type                          : Extended: 100G Base-SR4 or 25GBase-SR  # **æ”¶å‘å™¨ç±»å‹ï¼šæ”¯æŒ100G-SR4ï¼ˆ4é€šé“ï¼‰æˆ–25G-SRï¼ˆå•é€šé“ï¼‰**
Encoding                                  : 0x03 (NRZ)  # ç¼–ç æ–¹å¼ï¼šä¸å½’é›¶ç¼–ç ï¼ˆæ ‡å‡†å…‰ä¿¡å·ç¼–ç ï¼‰
BR, Nominal                               : 25750MBd  # æ³¢ç‰¹ç‡ï¼š25.75 GBdï¼ˆåƒå…†æ³¢ç‰¹ï¼‰
Rate identifier                           : 0x00 (unspecified)  # é€Ÿç‡æ ‡è¯†ï¼šæœªæŒ‡å®šç‰¹æ®Šé€Ÿç‡
Length (SMF,km)                           : 0km  # å•æ¨¡å…‰çº¤è·ç¦»ï¼šä¸æ”¯æŒå•æ¨¡å…‰çº¤
Length (SMF)                              : 0m  # å•æ¨¡å…‰çº¤è·ç¦»ï¼šä¸æ”¯æŒå•æ¨¡å…‰çº¤
Length (50um)                             : 0m  # 50å¾®ç±³å¤šæ¨¡å…‰çº¤è·ç¦»ï¼šä¸æ”¯æŒ
Length (62.5um)                           : 0m  # 62.5å¾®ç±³å¤šæ¨¡å…‰çº¤è·ç¦»ï¼šä¸æ”¯æŒ
Length (Copper)                           : 10m  # é“œç¼†è·ç¦»ï¼šç†è®ºå€¼ï¼ˆå®é™…ä¸æ”¯æŒé“œç¼†ï¼‰
Length (OM3)                              : 70m  # OM3å¤šæ¨¡å…‰çº¤è·ç¦»ï¼šæœ€å¤§æ”¯æŒ70ç±³
Laser wavelength                          : 850nm  # æ¿€å…‰æ³¢é•¿ï¼š850çº³ç±³ï¼ˆå¤šæ¨¡å…‰çº¤æ ‡å‡†ï¼‰
Vendor name                               : NADDOD  # å‚å•†åç§°ï¼šNADDOD
Vendor OUI                                : 00:00:00  # å‚å•†å”¯ä¸€æ ‡è¯†ï¼šå¼‚å¸¸å€¼ï¼ˆåº”ä¸º3å­—èŠ‚æ³¨å†Œæ ‡è¯†ï¼‰
Vendor PN                                 : SFP-25G-SR  # å‚å•†éƒ¨ä»¶å·ï¼š25GçŸ­è·å…‰æ¨¡å—
Vendor rev                                : A1  # ç¡¬ä»¶ç‰ˆæœ¬ï¼šA1ç‰ˆ
Option values                             : 0x08 0x1a  # é€‰é¡¹å€¼ï¼šåŠŸèƒ½ä½æ©ç ï¼ˆéœ€è§£æï¼‰
Option                                    : RX_LOS implemented  # åŠŸèƒ½é€‰é¡¹ï¼šæ¥æ”¶ä¿¡å·ä¸¢å¤±æ£€æµ‹å·²å®ç°
Option                                    : TX_FAULT implemented  # åŠŸèƒ½é€‰é¡¹ï¼šå‘é€æ•…éšœæ£€æµ‹å·²å®ç°
Option                                    : TX_DISABLE implemented  # åŠŸèƒ½é€‰é¡¹ï¼šå‘é€ç¦ç”¨æ§åˆ¶å·²å®ç°
Option                                    : Retimer or CDR implemented  # åŠŸèƒ½é€‰é¡¹ï¼šæ—¶é’Ÿæ¢å¤åŠŸèƒ½å·²å®ç°
BR margin, max                            : 0%  # æ³¢ç‰¹ç‡æœ€å¤§å®¹å·®ï¼š0%ï¼ˆä¸¥æ ¼åŒ¹é…ï¼‰
BR margin, min                            : 0%  # æ³¢ç‰¹ç‡æœ€å°å®¹å·®ï¼š0%ï¼ˆä¸¥æ ¼åŒ¹é…ï¼‰
Vendor SN                                 : 5A2310180192  # åºåˆ—å·ï¼šå”¯ä¸€è®¾å¤‡æ ‡è¯†
Date code                                 : 231018  # ç”Ÿäº§æ—¥æœŸï¼š2023å¹´10æœˆ18æ—¥



## ç‰¹æ€§

### RSS

äº”å…ƒç»„å“ˆå¸Œ

|    å­—æ®µ     | ç®€ç§° |   åŒ…å«   |           æ•ˆæœ           |
| :---------: | :--: | :------: | :----------------------: |
|  L3 proto   |  n   | åè®®ç±»å‹ |      åŒºåˆ†TCP/UDPç­‰       |
|    IP SA    |  s   |   æºIP   |    åˆ†æ•£ä¸åŒå®¢æˆ·ç«¯æµé‡    |
|    IP DA    |  d   |  ç›®çš„IP  |     åˆ†æ•£ä¸åŒæœåŠ¡æµé‡     |
| L4 src port |  f   |  æºç«¯å£  | åˆ†æ•£åŒä¸€å®¢æˆ·ç«¯çš„å¤šä¸ªè¿æ¥ |
| L4 dst port |  f   | ç›®çš„ç«¯å£ |     åˆ†æ•£ä¸åŒæœåŠ¡æµé‡     |

æ­¤å¤–è¿˜æœ‰ä¸€ä¸ªt,  **å¤šç§Ÿæˆ·ç¯å¢ƒ**ï¼šå¿…é¡»å¯ç”¨ `t`

| å­—æ®µ     | ç®€ç§° | åŒ…å«     | æ•ˆæœ |
| -------- | ---- | -------- | ---- |
| VLAN tag | t    | VLANæ ‡ç­¾ |      |

å¯é€‰é…ç½®

|   é…ç½®   |     å­—æ®µ      |   é€‚ç”¨åœºæ™¯   |                ç¼ºç‚¹                |
| :------: | :-----------: | :----------: | :--------------------------------: |
|  **sd**  |   IP SA+DA    | åŸºç¡€è´Ÿè½½å‡è¡¡ | åŒä¸€å®¢æˆ·ç«¯å¤šè¿æ¥å¯èƒ½åˆ†é…åˆ°åŒä¸€é˜Ÿåˆ— |
| **sdf**  | IP SA+DA+ç«¯å£ | æ ‡å‡†WebæœåŠ¡  |            ä¸èƒ½åŒºåˆ†åè®®            |
| **sdfn** |  å®Œæ•´äº”å…ƒç»„   | æœ€ä½³é€šç”¨é…ç½® |                 æ—                  |
|  **d**   |    ç›®çš„IP     |   CDNèŠ‚ç‚¹    |            æºIPä¸å¯æ§æ—¶            |



# DNS

## digï¼š DNSè§£ææŸ¥æ‰¾

åœ¨ä½¿ç”¨digå‘½ä»¤æ—¶ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®š@serveræ¥è¯·æ±‚ç‰¹å®šçš„DNSæœåŠ¡å™¨çš„ä¸»æœºåæˆ–IPåœ°å€ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šDNSæœåŠ¡å™¨ï¼Œåˆ™ä¼šä½¿ç”¨ç³»ç»Ÿå½“å‰é…ç½®çš„DNSæœåŠ¡å™¨ã€‚åœ¨æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥æŒ‡å®šè¦æŸ¥æ‰¾çš„åŸŸåå’Œè¦æ£€ç´¢çš„DNSè®°å½•ç±»å‹ï¼ˆé»˜è®¤ä¸ºAè®°å½•ç±»å‹ï¼‰

# lspci

## åŠŸèƒ½

**ç¡¬ä»¶è¯†åˆ«**

- è¯†åˆ«æœªçŸ¥ç¡¬ä»¶è®¾å¤‡
- è·å–è®¾å¤‡å‚å•†å’Œå‹å·
- ç¡®å®šç¡¬ä»¶IDï¼ˆç”¨äºé©±åŠ¨åŒ¹é…ï¼‰

 **é©±åŠ¨ç®¡ç†**

- æ£€æŸ¥è®¾å¤‡æ˜¯å¦åŠ è½½é©±åŠ¨
- ç¡®è®¤é©±åŠ¨æ˜¯å¦æ­£ç¡®ç»‘å®š
- æŸ¥æ‰¾æœªè¯†åˆ«çš„è®¾å¤‡

```shell
$lspci -D  
åœ°å€æ ¼å¼ï¼š[DOMAIN]:[BUS]:[DEVICE].[FUNCTION]
0000= åŸŸï¼ˆé€šå¸¸å•ç³»ç»Ÿä¸º 0000ï¼‰
05= æ€»çº¿å·
00= è®¾å¤‡å·
.2= åŠŸèƒ½å·
lspci -tv #åˆ—å‡ºæ‰€æœ‰PCIè®¾å¤‡
lspci |grep -i eth #æŸ¥çœ‹ç½‘å¡å‹å·
lspci -s 03:02.0 -vv     #-såé¢æ¥çš„æ˜¯æ¯ä¸ªè®¾å¤‡çš„æ€»çº¿ã€æ’æ§½ä¸ç›¸å…³å‡½æ•°åŠŸèƒ½
```





æ˜¾ç¤ºæ¨¡å¼:
**-t**		æ ‘çŠ¶æ˜¾ç¤ºï¼šç”¨äºç†è§£ç¡¬ä»¶è¿æ¥

é€‰é¡¹:
-v		Be verbose (-vv for very verbose)
-k		æ˜¾ç¤ºå†…æ ¸é©±åŠ¨
-x		Show hex-dump of the standard part of the config space
-xxx		Show hex-dump of the whole config space (dangerous; root only)
-xxxx		Show hex-dump of the 4096-byte extended config space (root only)
-b		Bus-centric view (addresses and IRQ's as seen by the bus)
-D		æ˜¾ç¤ºåŸŸå·

Resolving of device ID's to names:
-n		Show numeric ID's
-nn	      æ˜¾ç¤º(names & numbers)
-q		Query the PCI ID database for unknown ID's via DNS
-qq		As above, but re-query locally cached entries
-Q		Query the PCI ID database for all ID's via DNS

è®¾å¤‡é€‰æ‹©:
**-s** [[[[<domain>]:]<bus>]:][][.[<func>]]	Show only devices in selected slots
-d [<vendor>]:[<device>][:]		Show only devices with specified ID's

Other options:
-i <file>	Use specified ID database instead of /usr/share/hwdata/pci.ids
-p <file>	Look up kernel modules in a given file instead of default modules.pcimap
-M		Enable `bus mapping' mode (dangerous; root only)

PCI access options:
-A <method>	Use the specified PCI access method (see `-A help' for a list)
-O <par>=<val>	Set PCI access parameter (see `-O help' for a list)
-G		Enable PCI access debugging
-H <mode>	Use direct hardware access (<mode> = 1 or 2)
-F <file>	Read PCI configuration dump from a given file

### ç¤ºä¾‹

```shell
(py39) [hados@kubernetes-master ~]$ lspci -tvvnn
						#ä½ç½® 													[å‚å•†ID:è®¾å¤‡ID]
-[0000:00]-+-00.0  Intel Corporation Device [8086:4650] 
           +-02.0  Intel Corporation Device [8086:4692]
           #æ¡¥æ¥å™¨  [æ€»çº¿]  è®¾å¤‡  ç±»å‹
           +-06.0-[01]----00.0  Samsung Electronics Co Ltd Device [144d:a809]
           +-08.0  Intel Corporation Device [8086:464f]
           +-0a.0  Intel Corporation Device [8086:467d]
           +-14.0  Intel Corporation Device [8086:7ae0]
           +-14.2  Intel Corporation Device [8086:7aa7]
           +-14.3  Intel Corporation Device [8086:7af0]
           +-16.0  Intel Corporation Device [8086:7ae8]
           +-17.0  Intel Corporation Device [8086:7ae2]
           +-1c.0-[02]--
           +-1c.1-[03]----00.0  Realtek Semiconductor Co., Ltd. RTL8125 2.5GbE Controller [10ec:8125]
           +-1c.3-[04]----00.0  ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612]
           +-1f.0  Intel Corporation Device [8086:7a86]
           +-1f.3  Intel Corporation Device [8086:7ad0]
           +-1f.4  Intel Corporation Device [8086:7aa3]
           \-1f.5  Intel Corporation Device [8086:7aa4]
           
```

PCIe æ‰©å±•æ€»çº¿

|  æ€»çº¿  | æ¡¥æ¥å™¨  |  è®¾å¤‡   |            ç±»å‹             |
| :----: | :-----: | :-----: | :-------------------------: |
|   00   |         |         | æ ¹æ€»çº¿ï¼Œè¿æ¥CPU å’Œæ ¸å¿ƒè®¾å¤‡  |
| **01** | 00:06.0 | 01:00.0 | æ‰©å±•æ€»çº¿ï¼š Samsung NVMe SSD |
| **02** | 00:1c.0 | æ— è®¾å¤‡  |        ç©ºé—²PCIeæ’æ§½         |
| **03** | 00:1c.1 | 03:00.0 |     Realtek 2.5GbEç½‘å¡      |
| **04** | 00:1c.3 | 04:00.0 |     ASMedia SATAæ‰©å±•å¡      |



## pci<->dev

pci åœ°å€æ‰¾è®¾å¤‡

`ls $(find /sys/devices/ -name 'net' -type d|grep 'bus:dev.fun')`

è®¾å¤‡æ‰¾pci åœ°å€

`ethtool -i enp3s0`

## pci->numa_node

é€šè¿‡PCIåœ°å€æŸ¥æ‰¾NUMAèŠ‚ç‚¹

cat /sys/bus/pci/devices/0000:02:00.0/numa_node

# tcpdump

tcpdump -i  enp33s0f0  -vv

[tcpdump](/Users/chengxingfu/cloudu/äº‘åˆ›æ–°/ç½‘ç»œæŠ“åŒ…å·¥å…·tcpdump.md)

# taskset


Usage: taskset  [options]  [mask | cpu-list]  [pid|cmd [args...]]

ğŸ§°é€‰é¡¹:
 -a, --all-tasks     æ“ä½œæ‰€æœ‰çº¿ç¨‹
 -p, --pid      æ“ä½œç°æœ‰è¿›ç¨‹
 -c, --cpu-list     cpu åˆ—è¡¨
ğŸ“Œmask | cpu-list:

- mask(æ©ç è¡¨ç¤ºæ³•): æ¯ä¸ªcpuæ ¸å¿ƒå¯¹åº”ä¸€ä¸ªbitä½
  $CPU0=2^0=1$
  $CPU1=2^1=2$
  $CPU2=2^2=4$
  CPU0+1=1+2=03 è¡¨ç¤º
  CPU0+2=1+4=05 è¡¨ç¤º

- cpu-list(åˆ—è¡¨è¡¨ç¤ºæ³•)ï¼Œ ä¹Ÿå°±æ˜¯-c çš„å€¼ï¼Œè¿™ç§æ¯”è¾ƒå‹å¥½

ğŸ“Œpid|cmd [args...]  å°±æ˜¯è¿›ç¨‹å·æˆ–è€…è¿›ç¨‹

**ç¤ºä¾‹**

-  taskset 03 sshd -b 1024

> `03` æ˜¯ CPU äº²å’Œæ€§æ©ç ï¼ˆåå…­è¿›åˆ¶ï¼‰ï¼Œè¡¨ç¤ºç»‘å®šåˆ° CPU0 å’Œ CPU1ï¼ˆå› ä¸º 0x03 çš„äºŒè¿›åˆ¶æ˜¯ 0011ï¼Œå¯¹åº” CPU0 å’Œ CPU1ï¼‰

- æŸ¥çœ‹/è®¾ç½®è¿›ç¨‹äº²å’Œæ€§
      taskset -p 700  æŸ¥çœ‹
      taskset -p 03 700  æ©ç æ–¹å¼è®¾ç½®cpu
      taskset -pc 0,3,7-11 700  åˆ—è¡¨æ–¹å¼è®¾ç½®cpu

# route

è¯¥å‘½ä»¤æœ‰æ–°çš„æ›´å¼ºå¤§çš„å‘½ä»¤ä»£æ›¿ï¼šip route xxx, ä¸ä»…è¾“å‡ºç½‘å¡ï¼Œè¿˜è¾“å‡ºç½‘å¡ip

> ifconfig å¯¹ip åœ°å€çš„add/del æ“ä½œä¼šè‡ªåŠ¨ä¿®æ”¹è·¯ç”±è¡¨

è¯­æ³•ï¼š

route [-CFvnNee] [-A family |-4|-6]
route  [-v] [-A family |-4|-6] add [-net|-host] target [netmask Nm] [gw Gw] [metric N] [mss M] [window W] [irtt I] [reject] [mod] [dyn] [reinstate] [[dev] If]    
route  [-v] [-A family |-4|-6] del [-net|-host] target [gw Gw] [netmask Nm] [metric M] [[dev] If]
route  [-V] [--version] [-h] [--help]

```shell
root@node171:~# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.22.1    0.0.0.0         UG    100    0        0 enp4s0
10.0.2.0        0.0.0.0         255.255.255.0   U     0      0        0 enp1s0f1
10.0.3.0        0.0.0.0         255.255.255.0   U     0      0        0 enp1s0f1v0
122.199.10.0    0.0.0.0         255.255.255.0   U     101    0        0 enp1s0f0
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 enp4s0
192.168.22.0    0.0.0.0         255.255.255.0   U     100    0        0 enp4s0
```

1. **Destination**ï¼šç›®æ ‡ç½‘ç»œåœ°å€,  ç‰¹æ®Šçš„ 0.0.0.0 æ˜¯é»˜è®¤è·¯ç”±ï¼Œå…¸å‹åœºæ™¯æ˜¯è®¿é—®äº’è”ç½‘çš„æµé‡

2. **Gateway**ï¼š

   - `0.0.0.0`= ç›´è¿ç½‘ç»œï¼ˆæ— éœ€ç½‘å…³ï¼‰
   - å…¶ä»–IP = ä¸‹ä¸€è·³è·¯ç”±å™¨åœ°å€

3. **Genmask**ï¼šå­ç½‘æ©ç ï¼ˆä¸Destinationç»„åˆå®šä¹‰ç½‘æ®µï¼‰

   > ç¤ºä¾‹ä¸­ç›®æ ‡ç½‘æ®µ10.0.2.0/24æ˜¯ç›´è¿ç½‘ç»œï¼Œä¸”ä¼˜å…ˆçº§æœ€é«˜ï¼Œé€šè¿‡ç‰©ç†ç½‘å¡enp1s0f1 ç›´æ¥é€šä¿¡
   >
   > 169.254.0.0  , 255.255.0.0 å¯¹åº”ç½‘æ®µ169.254.0.0/16

4. **Flags**ï¼š

   - `U`ï¼šè·¯ç”±å¯ç”¨ï¼ˆUpï¼‰
   - `G`ï¼šéœ€è¦ç½‘å…³ï¼ˆGatewayï¼‰
   - `H`ï¼šä¸»æœºè·¯ç”±ï¼ˆå·²æ·˜æ±°ï¼‰

5. **Metric**ï¼šè·¯ç”±ä¼˜å…ˆçº§ï¼ˆå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰

6. **Iface**ï¼šæ•°æ®å‡ºå£æ¥å£

è·¯ç”±ä¼˜å…ˆçº§è§„åˆ™

1. **æœ€é•¿å‰ç¼€åŒ¹é…**ï¼š192.168.22.0/24 ä¼˜å…ˆäº 0.0.0.0/0
2. **Metricå€¼æ¯”è¾ƒ**ï¼š
   - ç›´è¿è·¯ç”±Metric=0 > é»˜è®¤è·¯ç”±Metric=100
   - ç›¸åŒå‰ç¼€æ—¶é€‰Metricå°çš„
3. **æ¥å£ä¼˜å…ˆçº§**ï¼šç›¸åŒMetricæ—¶æŒ‰æ¥å£é¡ºåºé€‰æ‹©

# netperf



1ã€ serverç«¯ï¼šnetserver

2ã€ clientç«¯ï¼š

netperf -t TCP_RR -H <server-ip> -l 30 -- -r 512 512 -O MEAN_LATENCY -D > TCP_RR_512.log

netperf -t UDP_RR -H <server-ip> -l 30 -- -r 512 512 -O MEAN_LATENCY -D > UDP_RR_512.log

# arp



# ç‰¹æ€§

1. FEC å‰å‘çº é”™æ¨¡å¼ï¼Œæé«˜äº†é“¾è·¯ç¨³å®šæ€§
  é€šè¿‡ethtool DEVNAMEå‘½ä»¤æ¥æŸ¥çœ‹æ”¯æŒçš„FECç±»å‹
  
   



# å¸®åŠ©æ–‡æ¡£çš„è¯­æ³•

æœ‰ä¸¤ç§æŸ¥çœ‹æ–¹æ³•ï¼š

1. help  ç®€ç•¥
2. man  æ›´è¯¦ç»†

```shell
$ip link help
Usage: ip link add [link DEV] [ name ] NAME
                   [ txqueuelen PACKETS ]
                   [ address LLADDR ]
                   [ broadcast LLADDR ]
                   [ mtu MTU ] [index IDX ]
                   [ numtxqueues QUEUE_COUNT ]
                   [ numrxqueues QUEUE_COUNT ]
                   type TYPE [ ARGS ]
```

1. `[]` å¯é€‰å‚æ•°
   ç¤ºä¾‹ï¼š[ name ] NAME è¡¨ç¤ºï¼š
   å¯ä»¥å†™ name eth0 æˆ–ç›´æ¥å†™ eth0

2. `[ part1 part2 ]` å‚æ•°åˆ†ç»„ï¼š  åŒæ—¶å‡ºç°æˆ–çœç•¥
3. `|`  äº’æ–¥é€‰æ‹©ï¼š`[A|B|C]` è¡¨ç¤ºå¯ä»¥é€‰ Aã€B æˆ– C ä¸­çš„ä¸€é¡¹
4. `{ | }` å¿…é€‰åˆ†ç»„ï¼šå¿…é¡»é€‰æ‹©ä¸€ä¸ª
   `[{ | }]`æ„å‘³ç€æ•´ä¸ªåˆ†ç»„æ˜¯å¯é€‰çš„
5. `<>`  å ä½ç¬¦ï¼š éœ€è¦æ›¿æ¢å…·ä½“å€¼








ethtool -S enp1s0f0  æŸ¥çœ‹ç½‘å¡å®ä¾‹çš„ç»Ÿè®¡ä¿¡æ¯

1. ç½‘å¡å¤šé˜Ÿåˆ—

ethtool -l enp1s0f0  æŸ¥çœ‹ç½‘å¡é˜Ÿåˆ—é…ç½®

ethtool -L enp1s0f0 combined 4  é…ç½®ç½‘å¡é˜Ÿåˆ—æ•°

2. RSS

é…ç½®ç½‘å¡udpåè®®æŒ‰ç…§ä¸‰å…ƒç»„è¿›è¡ŒRSSï¼š

ethtool --config-ntuple ${interface} rx-flow-hash udp4 sdt 

é…ç½®ç½‘å¡udpåè®®æŒ‰ç…§äº”å…ƒç»„è¿›è¡ŒRSSï¼š

ethtool --config-ntuple ${interface} rx-flow-hash udp4 sdtfn 

4. å‘é€/æ¥æ”¶æ–¹å‘æ ¡éªŒå’Œå¸è½½å¼€å…³
   ```shell
   ethtool -K enp1s0f0 tx/rx on/off
   ```

   

5. åˆ†ç‰‡å¸è½½
   ```shell
   ethtool -K enp1s0f0 tso/gro/gso/lro on/off
   ```

6. RX/TX buffer

   ethtool -g enp1s0f0 #æŸ¥çœ‹rx bufferé…ç½®

   ethtool -G enp1s0f0 rx 4096 tx 4096 # è®¾ç½®æ¥æ”¶é˜Ÿåˆ—

7. FEC Mode
   ç½‘å¡æ”¯æŒè®¾ç½®å‰å‘çº é”™ (FEC) æ¨¡å¼ï¼ŒFECæé«˜äº†é“¾è·¯ç¨³å®šæ€§

   ethtool --show-fec DEVNAME  #æŸ¥çœ‹ç½‘å¡è®¾ç½®çš„FECè®¾ç½®

   ethtool --set-fec DEVNAME encoding rs/auto/off #è®¾ç½®FEC

8. Bond

   

9. VLANéš”ç¦»

   ä¸åŒèŠ‚ç‚¹ä¸åŒVLANçš„VFéš”ç¦»ã€‚ä¸¤ä¸ªèŠ‚ç‚¹æ¥å£ç›´è¿æˆ–è€…é€šè¿‡äº¤æ¢æœºè¿æ¥ã€‚

   åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šåˆ†åˆ«åˆ›å»º1ä¸ªVFæ¥å£

   echo 1 > /sys/bus/pci/devices/0000:01:00.0/sirov_numvfs

   åœ¨èŠ‚ç‚¹1é…ç½®VFæ¥å£vlan ä¸º10ï¼Œå¹¶é…ç½®IPä¸º192.168.1.10

   ip link set DEVNAME vf 0 vlan 10

   ip addr add 192.168.1.10/24 dev DEVNAME

   åœ¨èŠ‚ç‚¹2é…ç½®VFæ¥å£vlanä¸º20ï¼Œå¹¶é…ç½®IPä¸º192.168.1.20

   ip link set DEVNAME vf 0 vlan 20

   ip addr add 192.168.1.20/24 dev DEVNAME

   é€šè¿‡pingå‘½ä»¤å‘ç°æ— æ³•äº’pingæˆåŠŸã€‚

   åŒèŠ‚ç‚¹ä¸åŒVLANçš„VFéš”ç¦»åŒæ ·é…ç½®åå¯å‘ç°æ— æ³•pingé€šã€‚

10. VLANå¸è½½

    ethtool -K enp1s0f0 tx-vlan-offload on

    ethtool -K enp1s0f0 rx-vlan-offload on

11. QlnQ(VLANå¥—å¨ƒ)

12. æ··æ‚æ¨¡å¼

    ip link set enp1s0f0 promisc on/off

13. Vxlanæ— çŠ¶æ€å¸è½½

14. ethtool -K enp1s0f0 tx-udp_tnl-segmentation on/off

    ethtool -K enp1s0f0 tx-udp_tnl-csum-segmentation on/off

15. ç»„æ’­

    æ·»åŠ ä¸€ä¸ªç»„æ’­ MAC åœ°å€åˆ°enp1s0f0v0ï¼ˆå¦‚ 01:00:5E:01:02:02ï¼‰

    ip link set enp1s0f0v0 multicast on

    ip maddr add 01:00.5e:01:02:02 dev enp1s0f0v0

16. æµé‡é™é€Ÿï¼Ÿ

    1. åŸºäºVFçš„æµé‡é™é€Ÿï¼š

    ip link set enp1s0f0 vf 0 rate 1000 

    2. åŸºäºVLANçš„æµé‡é™é€Ÿï¼š
       1. é…ç½®ä¼˜å…ˆçº§æ˜ å°„å…³ç³»

    echo 0,1,0,0,0,0,0,0 0,1G,0,0,0,0,0,0 > /sys/bus/pci/devices/0000\:01\:00.0/hw/vlan_qos

    â€‹	2. é…ç½®vlanå­æ¥å£

    ip link add enp1s0f0.10 link enp1s0f0 type vlan id 10

    â€‹	3. å°†vlanä¼˜å…ˆçº§æ˜ å°„åˆ°é˜Ÿåˆ—ä¼˜å…ˆçº§

    ip link set enp1s0f0.10 type vlan egress 0:1 1:1 2:1 3:1 4:1 5:1 6:1 7:1

17. æµé‡æ§åˆ¶
    åœ¨ç¡¬ä»¶å±‚é¢ï¼Œæµæ§æ§åˆ¶çš„æ˜¯å‘é€æ–¹æ˜¯å¦æš‚åœå‘åŒ…ã€æ˜¯å¦ç­‰å¾…å¯¹æ–¹ç¼“å†²åŒºé‡Šæ”¾èµ„æºåå†ç»§ç»­å‘é€

18. MTUå¯è®¾ç½®
    æœ€å¤§ä¼ è¾“å•å…ƒï¼ŒæŒ‡çš„æ˜¯ç½‘ç»œæ¥å£ä¸€æ¬¡èƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§æ•°æ®åŒ…å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰

    ifconfig enp1s0f0  mtu  MTU_NUM

19. å·¨å¸§
    ifconfig enp1s0f0 mtu 9000   # æ”¹

    ifconfig enp1s0f0  #æŸ¥

20. PXE
    æ˜¯ä¸€ç§ä½¿ç”¨ç½‘ç»œæ¥å£å¯åŠ¨æœåŠ¡å™¨çš„æœºåˆ¶ï¼Œå…è®¸è®¡ç®—æœºåœ¨BIOS/UEFIé˜¶æ®µåŠ è½½ç½‘å¡Option ROMé©±åŠ¨ï¼Œé€šè¿‡å±€åŸŸç½‘è·å–å¯åŠ¨æ–‡ä»¶åŠæ“ä½œç³»ç»Ÿé•œåƒã€‚

21. SR-IOVè™šæ‹ŸåŒ–
    å…è®¸PCI Expressè®¾å¤‡æ˜¾ç¤ºä¸ºå¤šä¸ªå•ç‹¬çš„ç‰©ç†PCI Expressè®¾å¤‡ã€‚SR-IOVå…è®¸åœ¨è™šæ‹Ÿæœº (vm) ä¹‹é—´é«˜æ•ˆå…±äº«PCIè®¾å¤‡ã€‚  **æ–‡æ¡£ä¸­è¿™é‡Œæœ‰ç¬”è¯¯**
