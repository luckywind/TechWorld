# 什么是数据湖技术

一种数据存储理念：即在系统或存储库中以自然格式存储数据的方法。

> 数据湖作为一个集中的存储库，可以在其中存储任意规模的结构化和非结构化数据。在数据湖中，可以存储不需要对其进行结构化的数据，这样就可以运行不同类型的分析。 <font color=red>通过数据湖技术可以实现”敏捷”地统一存储和统一分析，能够最大程度地解决大数据的痛点问题。</font>

**简单表述总结为以下8点：**

\1) 数据湖需要提供足够用的数据存储能力，存储保存了一个企业/组织中的所有数据。
\2) 数据湖可以存储海量的任意类型的数据，包括结构化、半结构化和非结构化数据。
3)数据湖中的数据是原始数据，是业务数据的完整副本。
\4) 需要具备完善的数据管理能力（完善的元数据），可以管理各类数据相关的要素，包括数据源、数据格式、连接信息、数据schema、权限管理等。
\5) 需要具备多样化的分析能力，包括但不限于批处理、流式计算、交互式分析以及机器学习；同时，还需要提供一定的任务调度和管理能力。
\6) 需要具备完善的数据生命周期管理能力。不仅需要存储原始数据，还要能够保存各类分析处理的中间结果，并完整的记录数据的分析处理过程，帮助用户完整详细追溯任意一条数据的产生过程。
7)需要具备完善的数据获取和数据发布能力。
\8) 对于大数据的支持，包括超大规模存储以及可扩展的大规模数据处理能力。

**三大理念**：
    1）能够存储海量的原始数据
    2）能够支持任意的数据格式
   3）有较好的分析和处理能力
**六大基本特征:**
　　1）“保真性”
　　2）“灵活性”
　　3）“可管理”
　　4）“可追溯”
　　5）丰富的计算引擎
　　6）多模态的存储引擎
　　
**当前的数据仓库痛点**：
   1）只能存储结构化数据，无法采集存储非结构化数据
 　2）无法存储原始数据，所有的数据须经过ETL清洗过程
 　3）离线数仓的数据表牵一发而动全身，数据调整工程量大
 　4）实时数仓存储空间有限，无法采集和存储海量实时数据
 　5）回溯效率低下，实时数据和离线数据计算接口难以统一

# 三大数据湖技术Delta/Hudi/Iceberg对比

在没有 Delta 数据湖之前，Databricks 的客户一般会采用经典的 Lambda 架构来构建他们的流批处理场景。以用户点击行为分析为例，点击事件经 Kafka 被下游的 Spark Streaming 作业消费，分析处理（业务层面聚合等）后得到一个实时的分析结果，这个实时结果只是当前时间所看到的一个状态，无法反应时间轴上的所有点击事件。所以为了保存全量点击行为，Kafka 还会被另外一个 Spark Batch 作业分析处理，导入到文件系统上（一般就是 parquet 格式写 HDFS 或者 S3，可以认为这个文件系统是一个简配版的数据湖），供下游的 Batch 作业做全量的数据分析以及 AI 处理等。



这套方案其实存在很多问题 :

第一、批量导入到文件系统的数据一般都**缺乏全局的严格 schema 规范**，下游的 Spark 作业做分析时碰到格式混乱的数据会很麻烦，每一个分析作业都要过滤处理错乱缺失的数据，成本较大；

第二、数据写入文件系统这个过程没有 ACID 保证，用户可能读到导入中间状态的数据。所以上层的批处理作业为了躲开这个坑，只能调度避开数据导入时间段，可以想象这对业务方是多么不友好；同时也无法保证多次导入的快照版本，例如业务方想读最近 5 次导入的数据版本，其实是做不到的。

第三、**用户无法高效 upsert/delete 历史数据**，parquet 文件一旦写入 HDFS 文件，要想改数据，就只能全量重新写一份的数据，成本很高。事实上，这种需求是广泛存在的，例如由于程序问题，导致错误地写入一些数据到文件系统，现在业务方想要把这些数据纠正过来；线上的 MySQL binlog 不断地导入 update/delete 增量更新到下游数据湖中；某些数据审查规范要求做强制数据删除，例如欧洲出台的 GDPR 隐私保护等等。

第四、频繁地数据导入会在文件系统上产生大量的**小文件**，导致文件系统不堪重负，尤其是 HDFS 这种对文件数有限制的文件系统。

所以，在 Databricks 看来，以下四个点是数据湖必备的。

![img](https://piggo-picture.oss-cn-hangzhou.aliyuncs.com/39141b6f81e6cb2d8d3d8a471aae479e.png)



Databricks 在设计 Delta 时，希望做到流批作业在数据层面的统一：

业务数据经过 Kafka 导入到统一的数据湖中（无论批处理，还是流处理），上层业务可以借助各种分析引擎做进一步的商业报表分析、流式计算以及 AI 分析等等。

![img](https://piggo-picture.oss-cn-hangzhou.aliyuncs.com/c90b97c8b3c96d8e3c31372a5cbdb247.png)







## 四种数据湖技术对比

![img](https://piggo-picture.oss-cn-hangzhou.aliyuncs.com/7595d1fd4690e0851fa77da6c39cba45.png)